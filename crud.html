<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SuitUp Admin · CRUD</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{ --bg:#0f1116; --panel:#171a21; --panel-2:#1c2029; }
    body{ background:var(--bg); color:#e9eef6; }
    .sidebar{ background:var(--panel); min-height:100vh; border-right:1px solid #2a2f3a; position:sticky; top:0; }
    .nav-link{ color:#cfd8e3; }
    .nav-link.active,.nav-link:hover{ color:#fff; background:var(--panel-2); border-radius:.5rem; }
    .card-panel{ background:var(--panel); border:1px solid #2a2f3a; border-radius:.9rem; }
    .searchbar{ background:var(--panel); border:1px solid #2a2f3a; border-radius:.6rem; }
    .pill{ border:1px solid #2a2f3a; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; }
    .table thead th{ color:#a8b4c6; font-weight:600; }
    .table tbody td{ vertical-align: middle; }
    .empty{ border:1px dashed #3a4356; border-radius:.75rem; padding:2rem; text-align:center; color:#9fb3c8; }
    @media (max-width: 991.98px){ .sidebar{ position:static; min-height:auto; } }
  </style>
</head>
<body>

  <div class="container-fluid">
    <div class="row g-0">

      <!-- SIDEBAR -->
      <nav class="col-lg-2 col-md-3 p-3 p-lg-4 sidebar">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-2">
            <span class="rounded-circle d-inline-flex align-items-center justify-content-center" style="width:28px;height:28px;background:#2b3240;">
              <i class="bi bi-scissors"></i>
            </span>
            <span class="fw-bold">SuitUp Admin</span>
          </div>
          <button class="btn btn-outline-light d-md-none" data-bs-toggle="collapse" data-bs-target="#sideLinks"><i class="bi bi-list"></i></button>
        </div>

        <div id="sideLinks" class="collapse d-md-block mt-4">
          <ul class="nav flex-column gap-1">
            <li class="nav-item"><a class="nav-link px-3 py-2" href="dashboard.html"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2" href="inventory.html"><i class="bi bi-box-seam me-2"></i>Inventory</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2" href="styles.html"><i class="bi bi-rulers me-2"></i>Styles</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2" href="orders.html"><i class="bi bi-bag-check me-2"></i>Orders</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2" href="customers.html"><i class="bi bi-people me-2"></i>Customers</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2" href="settings.html"><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li class="nav-item"><a class="nav-link px-3 py-2 active" href="crud.html"><i class="bi bi-table me-2"></i>CRUD</a></li>
          </ul>
          <hr class="border-secondary-subtle">
          <a class="btn btn-outline-danger w-100" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
        </div>
      </nav>

      <!-- MAIN -->
      <main class="col-lg-10 col-md-9 p-4 p-lg-5">

        <!-- Header -->
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
          <div>
            <h1 class="h3 mb-1">CRUD Operations</h1>
            <div class="text-secondary">Create, read, update, delete content across modules</div>
          </div>
          <div class="d-flex gap-2">
            <div class="input-group searchbar">
              <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
              <input id="globalSearch" class="form-control bg-transparent border-0" placeholder="Search current table…">
            </div>
            <button id="btnAdd" class="btn btn-primary"><i class="bi bi-plus-lg me-2"></i>Add</button>
            <button id="btnExport" class="btn btn-outline-secondary"><i class="bi bi-download me-2"></i>Export CSV</button>
          </div>
        </div>

        <!-- Tabs for entities -->
        <ul class="nav nav-tabs mb-3" id="entityTabs" role="tablist">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#t_about" type="button" role="tab"><i class="bi bi-info-circle me-1"></i>About</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t_homeimg" type="button" role="tab"><i class="bi bi-image me-1"></i>Home Images</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t_styles" type="button" role="tab"><i class="bi bi-rulers me-1"></i>Styles</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t_materials" type="button" role="tab"><i class="bi bi-bricks me-1"></i>Materials</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t_checkout" type="button" role="tab"><i class="bi bi-credit-card me-1"></i>Checkout</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t_inventory" type="button" role="tab"><i class="bi bi-clipboard-data me-1"></i>Inventory</button></li>
        </ul>

        <!-- Table Shell -->
        <div class="card-panel p-3 p-lg-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="text-secondary small"><span id="rowCount">0</span> items • <span id="schemaName">—</span></div>
            <div class="d-flex gap-2">
              <span class="pill">Sort: <span id="sortLabel">—</span></span>
              <select id="pageSize" class="form-select form-select-sm w-auto">
                <option value="5">5 / page</option>
                <option value="10" selected>10 / page</option>
                <option value="20">20 / page</option>
              </select>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table align-middle table-hover" id="crudTable">
              <thead><tr id="theadRow"></tr></thead>
              <tbody id="tbody"></tbody>
            </table>
            <div id="emptyState" class="empty d-none"><i class="bi bi-inboxes me-2"></i>No items yet. Click <b>Add</b> to create your first record.</div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-secondary small">Page <span id="pageNum">1</span> of <span id="pageTotal">1</span></div>
            <ul class="pagination pagination-sm mb-0" id="pager"></ul>
          </div>
        </div>

      </main>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content bg-dark border-secondary">
        <div class="modal-header">
          <h5 class="modal-title" id="editTitle">Add Item</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editForm" class="row g-3"></form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="btnSave" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark border-secondary">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-trash3 me-2"></i>Delete Item</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete <span id="delLabel" class="fw-semibold">this item</span>?
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="btnDelete" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index:1080;">
    <div id="okToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="bi bi-check2-circle me-2"></i><span id="toastMsg">Saved.</span></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ---------- Demo Data & Schemas ----------
    const schemas = {
      about: {
        name: 'About',
        columns: [
          { key:'title', label:'Title', type:'text', required:true },
          { key:'tagline', label:'Tagline', type:'text' },
          { key:'updated', label:'Updated', type:'date', readonly:true }
        ],
        data: [
          { id:1, title:'SuitUp Tailoring Co.', tagline:'Made-to-measure in 72 hours', updated:'2025-11-01' }
        ],
        idKey: 'id'
      },
      homeimg: {
        name: 'Home Images',
        columns: [
          { key:'label', label:'Label', type:'text', required:true },
          { key:'url', label:'Image URL', type:'url', required:true },
          { key:'link', label:'CTA Link', type:'text' },
          { key:'active', label:'Active', type:'checkbox' }
        ],
        data: [
          { id:1, label:'Winter Collection', url:'https://picsum.photos/seed/winter/800/300', link:'/winter', active:true },
          { id:2, label:'Wedding Edit', url:'https://picsum.photos/seed/wedding/800/300', link:'/wedding', active:true }
        ],
        idKey: 'id'
      },
      styles: {
        name:'Styles',
        columns:[
          { key:'name', label:'Style Name', type:'text', required:true },
          { key:'fit', label:'Fit', type:'select', options:['Slim','Classic','Athletic','Relaxed'] },
          { key:'buttons', label:'Buttons', type:'select', options:['1','2','Double-breasted (6)'] },
          { key:'price', label:'Base Price (₹)', type:'number' },
          { key:'active', label:'Active', type:'checkbox' }
        ],
        data:[
          { id:1, name:'Two-piece Suit', fit:'Slim', buttons:'2', price:24990, active:true },
          { id:2, name:'Tuxedo', fit:'Classic', buttons:'Double-breasted (6)', price:34990, active:true }
        ],
        idKey:'id'
      },
      materials: {
        name:'Materials',
        columns:[
          { key:'sku', label:'SKU', type:'text', required:true },
          { key:'name', label:'Material', type:'text' },
          { key:'supplier', label:'Supplier', type:'text' },
          { key:'stock', label:'Stock', type:'number' },
          { key:'reorder', label:'Reorder @', type:'number' }
        ],
        data:[
          { id:1, sku:'FAB-NAV-402', name:'Navy Wool 110s', supplier:'Textura Mills', stock:640, reorder:200 },
          { id:2, sku:'LIN-CH-021', name:'Charcoal Lining', supplier:'Royal Looms', stock:210, reorder:150 }
        ],
        idKey:'id'
      },
      checkout: {
        name:'Checkout',
        columns:[
          { key:'currency', label:'Currency', type:'select', options:['INR','USD','EUR'] },
          { key:'tax', label:'Tax %', type:'number' },
          { key:'shipping', label:'Shipping (₹)', type:'number' },
          { key:'cod', label:'COD Enabled', type:'checkbox' }
        ],
        data:[
          { id:1, currency:'INR', tax:18, shipping:199, cod:false }
        ],
        idKey:'id'
      },
      inventory: {
        name:'Inventory',
        columns:[
          { key:'product', label:'Product', type:'text', required:true },
          { key:'sku', label:'SKU', type:'text' },
          { key:'bin', label:'Bin', type:'text' },
          { key:'qty', label:'Qty', type:'number' },
          { key:'status', label:'Status', type:'select', options:['OK','Low','Out'] }
        ],
        data:[
          { id:1, product:'Buttons — Brown 18mm', sku:'BTN-BR-18', bin:'A1', qty:28400, status:'OK' },
          { id:2, product:'Zipper — Silver 22cm', sku:'ZIP-SL-22', bin:'B4', qty:120, status:'Low' }
        ],
        idKey:'id'
      }
    };

    // ---------- State ----------
    let current = 'about';
    let editingId = null;
    let sortKey = null, sortDir = 1;
    let page = 1, pageSize = 10;

    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);

    // ---------- Rendering ----------
    function renderSchema(){
      const schema = schemas[current];
      $('#schemaName').textContent = schema.name;
      // header
      const thead = $('#theadRow'); thead.innerHTML = '';
      schema.columns.forEach(col=>{
        const th = document.createElement('th');
        th.textContent = col.label;
        th.style.cursor = 'pointer';
        th.addEventListener('click', ()=>{ sortKey = col.key; sortDir *= -1; renderRows(); });
        thead.appendChild(th);
      });
      const act = document.createElement('th'); act.style.width='110px'; thead.appendChild(act);
      // rows
      renderRows();
    }

    function getFilteredSortedData(){
      const schema = schemas[current];
      const q = $('#globalSearch').value.toLowerCase();
      let rows = [...schema.data].filter(r => JSON.stringify(r).toLowerCase().includes(q));
      if(sortKey){
        rows.sort((a,b)=>{
          const va = a[sortKey] ?? '', vb = b[sortKey] ?? '';
          return (va>vb?1:va<vb?-1:0) * sortDir;
        });
      }
      $('#sortLabel').textContent = sortKey ? `${schema.columns.find(c=>c.key===sortKey).label} ${sortDir>0?'↑':'↓'}` : 'none';
      return rows;
    }

    function renderRows(){
      const tbody = $('#tbody'); tbody.innerHTML = '';
      const rows = getFilteredSortedData();
      const total = rows.length; $('#rowCount').textContent = total;
      const totalPages = Math.max(1, Math.ceil(total/pageSize));
      page = Math.min(page, totalPages);
      const start = (page-1)*pageSize, end = start + pageSize;

      rows.slice(start,end).forEach(r=>{
        const tr = document.createElement('tr');
        schemas[current].columns.forEach(col=>{
          const td = document.createElement('td');
          let val = r[col.key];
          if(col.type==='checkbox') val = val ? 'Yes' : 'No';
          td.textContent = val ?? '—';
          tr.appendChild(td);
        });
        const tdAct = document.createElement('td');
        tdAct.innerHTML = `
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-light" data-action="edit" data-id="${r[schemas[current].idKey]}"><i class="bi bi-pencil-square"></i></button>
            <button class="btn btn-outline-danger" data-action="del" data-id="${r[schemas[current].idKey]}"><i class="bi bi-trash3"></i></button>
          </div>`;
        tr.appendChild(tdAct);
        tbody.appendChild(tr);
      });

      $('#emptyState').classList.toggle('d-none', total>0);
      renderPager(totalPages);
      $('#pageNum').textContent = page; $('#pageTotal').textContent = totalPages;
    }

    function renderPager(totalPages){
      const pager = $('#pager'); pager.innerHTML = '';
      const mk = (label, p, disabled=false, active=false)=>{
        const li = document.createElement('li'); li.className = `page-item ${disabled?'disabled':''} ${active?'active':''}`;
        const a = document.createElement('a'); a.className='page-link'; a.textContent=label; a.href='#';
        a.addEventListener('click', e=>{ e.preventDefault(); if(!disabled){ page=p; renderRows(); } });
        li.appendChild(a); return li;
      };
      pager.appendChild(mk('Prev', Math.max(1,page-1), page===1));
      for(let i=1;i<=totalPages;i++) pager.appendChild(mk(i, i, false, i===page));
      pager.appendChild(mk('Next', Math.min(totalPages,page+1), page===totalPages));
    }

    // ---------- Modal Forms ----------
    function openEditor(data = {}){
      const schema = schemas[current];
      const form = $('#editForm'); form.innerHTML = '';
      schema.columns.forEach(col=>{
        const colWrap = document.createElement('div'); colWrap.className='col-md-6';
        const id = `f_${col.key}`;
        const label = `<label class="form-label">${col.label}${col.required? ' *':''}</label>`;
        let control = '';
        if(col.readonly){
          control = `<input class="form-control" id="${id}" value="${data[col.key] ?? ''}" disabled>`;
        }else if(col.type==='select'){
          control = `<select class="form-select" id="${id}">${(col.options||[]).map(o=>`<option ${ (data[col.key]===o)?'selected':'' }>${o}</option>`).join('')}</select>`;
        }else if(col.type==='checkbox'){
          control = `<div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="${id}" ${data[col.key]?'checked':''}>
                      <label class="form-check-label">${col.label}</label>
                     </div>`;
        }else if(col.type==='date' || col.type==='number' || col.type==='url' || col.type==='text'){
          control = `<input type="${col.type==='text'?'text':col.type}" class="form-control" id="${id}" value="${data[col.key] ?? ''}" ${col.required?'required':''}>`;
        }else{
          control = `<input class="form-control" id="${id}" value="${data[col.key] ?? ''}">`;
        }
        colWrap.innerHTML = col.type==='checkbox' ? control : (label + control);
        form.appendChild(colWrap);
      });

      $('#editTitle').textContent = (editingId==null?'Add ':'Edit ') + schemas[current].name.slice(0,-1);
      new bootstrap.Modal('#editModal').show();
    }

    function collectFormValues(){
      const schema = schemas[current];
      const obj = {};
      let valid = true;
      schema.columns.forEach(col=>{
        const id = `#f_${col.key}`;
        if(col.type==='checkbox'){
          obj[col.key] = $(id).checked;
        }else if(col.readonly){
          obj[col.key] = $(id).value;
        }else{
          const v = $(id).value.trim();
          if(col.required && !v) valid=false;
          obj[col.key] = col.type==='number' ? Number(v||0) : v;
        }
      });
      return { obj, valid };
    }

    // ---------- Actions ----------
    function addItem(){
      editingId = null;
      openEditor();
    }

    function editItem(id){
      editingId = id;
      const row = schemas[current].data.find(r => r[schemas[current].idKey]===id);
      openEditor(row || {});
    }

    function deleteItem(id){
      const row = schemas[current].data.find(r => r[schemas[current].idKey]===id);
      $('#delLabel').textContent = row?.title || row?.name || row?.label || row?.sku || row?.product || `ID ${id}`;
      $('#btnDelete').onclick = ()=>{
        const arr = schemas[current].data;
        const idx = arr.findIndex(r => r[schemas[current].idKey]===id);
        if(idx>-1) arr.splice(idx,1);
        bootstrap.Modal.getInstance($('#confirmModal')).hide();
        renderRows(); toast('Deleted.');
      };
      new bootstrap.Modal('#confirmModal').show();
    }

    function saveItem(e){
      e.preventDefault();
      const { obj, valid } = collectFormValues();
      if(!valid){ toast('Please fill required fields.', true); return; }
      const schema = schemas[current];
      if(editingId==null){
        const maxId = Math.max(0, ...schema.data.map(r=>r[schema.idKey]||0));
        obj[schema.idKey] = maxId + 1;
        // convenience auto-set
        if(schema.name==='About' && !obj.updated){
          obj.updated = new Date().toISOString().slice(0,10);
        }
        schema.data.unshift(obj);
        toast('Added.');
      }else{
        const idx = schema.data.findIndex(r => r[schema.idKey]===editingId);
        schema.data[idx] = { ...schema.data[idx], ...obj };
        toast('Saved.');
      }
      bootstrap.Modal.getInstance($('#editModal')).hide();
      renderRows();
    }

    function exportCSV(){
      const rows = getFilteredSortedData();
      const cols = schemas[current].columns.map(c=>c.label);
      const keys = schemas[current].columns.map(c=>c.key);
      const csv = [cols.join(',')].concat(rows.map(r=>keys.map(k=>String(r[k]??'')).join(','))).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${schemas[current].name.toLowerCase().replace(/\s+/g,'_')}.csv`;
      a.click(); URL.revokeObjectURL(a.href);
    }

    function toast(msg, warn=false){
      $('#toastMsg').textContent = msg;
      const t = new bootstrap.Toast('#okToast', { delay: 1800 });
      const el = $('#okToast'); el.classList.toggle('text-bg-danger', warn); el.classList.toggle('text-bg-success', !warn);
      t.show();
    }

    // ---------- Events ----------
    $('#btnAdd').addEventListener('click', addItem);
    $('#btnSave').addEventListener('click', saveItem);
    $('#btnExport').addEventListener('click', exportCSV);
    $('#globalSearch').addEventListener('input', ()=>{ page=1; renderRows(); });
    $('#pageSize').addEventListener('change', (e)=>{ pageSize = Number(e.target.value); page=1; renderRows(); });

    // Delegate table buttons
    $('#crudTable').addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const id = Number(btn.dataset.id);
      if(btn.dataset.action==='edit') editItem(id);
      if(btn.dataset.action==='del'){
        deleteItem(id);
      }
    });

    // Tabs switch
    $$('#entityTabs .nav-link').forEach((btn, i)=>{
      btn.addEventListener('shown.bs.tab', (ev)=>{
        const id = ev.target.getAttribute('data-bs-target');
        current = ({'#t_about':'about','#t_homeimg':'homeimg','#t_styles':'styles','#t_materials':'materials','#t_checkout':'checkout','#t_inventory':'inventory'})[id];
        sortKey=null; sortDir=1; page=1;
        renderSchema();
      });
    });

    // ---------- Init ----------
    renderSchema();
  </script>
</body>
</html>
